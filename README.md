# Платформа торговой сети электроники

## Описание проекта

Backend-часть платформы для управления иерархической сетью по продаже электроники. Проект реализован на Django и Django REST Framework с использованием существующей системы пользователей и аутентификации.

## Основные функции

- **Иерархическая структура сети**:
  - Завод (уровень 0)
  - Розничная сеть (уровень 1)
  - Индивидуальный предприниматель (уровень 2)
- **Управление элементами сети** с привязкой к существующей системе пользователей
- **Контроль задолженностей** перед поставщиками
- **Админ-панель** с дополнительными функциями:
  - Ссылки на поставщиков
  - Фильтр по городам
  - Очистка задолженностей
- **REST API** с ограничением доступа по ролям

## Технологии

- Python 3.8+
- Django 3.2+
- Django REST Framework 3.12+
- PostgreSQL 13+
- Существующая система аутентификации (JWT)
- Docker (опционально)
- drf-spectacular (документация API)
- django-filter

## Модели

### Унаследованные от предыдущего проекта
- **Пользователь (User)**:
  - Роли: user, admin
  - Аутентификация по email
  - Телефон, страна, аватар
  - Генерация токенов

### Новые модели
- **Элемент сети (NetworkNode)**:
  - Тип (завод/розничная сеть/ИП)
  - Контакты (email, страна, город, улица, дом)
  - Поставщик (FK)
  - Задолженность (Decimal)
  - Автоматический расчет уровня

- **Продукт (Product)**:
  - Название, модель
  - Дата выхода на рынок
  - Привязка к элементу сети

## Права доступа

Используется существующая система пермишенов:

- **IsAdmin**: Только для администраторов
- **IsAuthor**: Для владельцев объектов
- Дополнительно:
  - Запрет на изменение задолженности через API
  - Фильтрация по странам

## Установка и запуск

### 1. Клонирование репозитория
```bash
git clone <ваш-репозиторий>
cd <папка-проекта>
```

### 2. Настройка окружения
```bash
cp .env.example .env
# Заполните переменные в .env
```

### 3. Миграции
```bash
python manage.py migrate
```

### 4. Создание суперпользователя
```bash
python manage.py createsuperuser
```

### 5. Запуск
```bash
python manage.py runserver
```

## Интеграция существующего кода

Проект использует проверенные модули из предыдущей разработки:

1. **Модель пользователя**:
   - Без изменений (email auth, роли, профиль)
   - Готовая система токенов

2. **Пермишены**:
   - `IsAdmin` для административных действий
   - `IsAuthor` для контроля владельцев

3. **Админка**:
   - Наследование от существующих настроек
   - Добавлены кастомные actions

## API Endpoints

Документация: `/swagger/` или `/redoc/`

Основные endpoints:
- `/api/networks/` - CRUD для элементов сети
- `/api/products/` - Управление продуктами
- `/api/users/` - Существующие пользовательские endpoints

## Особенности реализации

1. **Безопасность**:
   - Запрет прямого изменения задолженности
   - Фильтрация по странам
   - Наследование проверенной auth-системы

2. **Администрирование**:
   - Кастомные actions в админке
   - Удобные фильтры
   - Ссылки между объектами

3. **Интеграция**:
   - Полная совместимость с существующим User
   - Использование готовых пермишенов
   - Минимальные изменения в работающий код

## Тестирование

Запуск тестов:
```bash
python manage.py test
```

Существующие тесты для:
- Модели User (100% coverage)
- Новые тесты для NetworkNode и Product (90%+)

## Автор
Telegram @eslobodyanik
```
